## 확률 변수에 대한 조건화 (Conditioning a Random Variable on an Event)
- 사건 A에 대해 조건화된 확률 변수 X의 조건부 확률 질량 함수(Conditional PMF)는 $P(A) > 0$일 때 다음과 같이 정의된다.
	- $p_{X|A}(x) = P(X = x | A) = \frac{P(\{X = x\} \cap A)}{P(A)}$

### 추가 설명
- 조건부 확률 질량 함수는 특정 사건 A가 주어졌을 때 확률 변수 X의 값을 찾는 데 사용된다.
- 조건부 확률은 사건 A가 발생한 상황에서 확률 변수 X가 특정 값을 가질 확률을 나타낸다.
- 공식에서 $P(\{X = x\} \cap A)$는 X가 x 값을 가지면서 동시에 사건 A가 발생하는 확률을 의미한다.
- $P(A)$는 사건 A의 발생 확률을 나타낸다.

[예제1](#예제-1)

# 다른 확률 변수에 대한 조건화 (Conditioning one Random Variable on Another)
> 확률 변수 X와 Y가 동일한 실험과 관련되어 있을 때, Y에 대해 조건화된 X의 조건부 확률 질량 함수를 정의한다.
> Conditional PMF of X given Y:  $p_{X|Y}(x | y) = P(X = x | Y = y)$
- 이는 사건 A의 형태 $\{Y = y\}$로 정의의 특수화와 같다.
- 조건부 확률의 정의를 사용하면 다음과 같다.
	- $p_{X|Y}(x | y) = \frac{P(X = x, Y = y)}{P(Y = y)} = \frac{p_{X,Y}(x, y)}{p_Y(y)}$

### 예시
Joint Probability Mass Function (P(X,Y)):

| X \\ Y |   1  |   2  |   3  |   4  |
|-------|------|------|------|------|
|  1    | 0.1  | 0.1  |  0   | 0.2  |
|  2    | 0.05 | 0.05 | 0.1  |  0   |
|  3    |  0   | 0.1  | 0.2  | 0.1  |

Marginal Probability P(Y):
|   Y   |  1   |   2  |   3  |  4   |
|-------|------|------|------|------|
| P(Y)  | 0.15 | 0.25 | 0.3  | 0.3  |

Conditional Probability Mass Function (P(X|Y)):
| X \\ Y |   1  |   2  |   3  |   4  |
|-------|------|------|------|------|
|  1    | 0.66 | 0.4  |  0   | 0.66 |
|  2    | 0.33 | 0.2  | 0.33 |  0   |
|  3    |  0   | 0.4  | 0.66 | 0.33 |

첫 번째 표는 $X$와 $Y$의 합동 확률 분포를 보여준다.
예를 들어, $P(X=1, Y=1) = 0.1$, $P(X=2, Y=1) = 0.05$이다.
두 번째 표는 $Y$의 값에 대한 주변 확률 분포를 보여준다.
예를 들어, $P(Y=1) = 0.15$, $P(Y=2) = 0.25$이다.
세 번째 표는 $Y$가 주어졌을 때 $X$의 조건부 확률 분포를 보여준다.
예를 들어, $P(X=1|Y=1) = 0.66$, $P(X=2|Y=1) = 0.33$이다.

Conditional PMF 계산순서
1. Joint PMF 계산
2. Marginalization
3. Marginal PMF 계산
4. Conditional PMF 계산 = Joint PMF / Marginal PMF

예시) 
1. Joint PMF: $P(X=2, Y=1)
2. Marginal PMF: $P(Y=1)
3. Conditional PMF: $P(X=2|Y=1) = \frac{P(X=2, Y=1)}{P(Y=1)} = \frac{0.05}{0.15} = 0.33$

[예제 2](#예제-2)

# 유용한 공식 (Useful Rules)

조건부 PMF(Conditional PMF)로부터 결합 PMF(Joint PMF)를 계산하는 방법:
- $Y=y$일 때 $X$의 조건부 PMF는 결합 PMF와 관련이 있다.
- $p_{X,Y}(x, y) = p_Y(y) p_{X|Y}(x | y)$.

이는 확률을 계산할 때 사용되는 곱셈 규칙과 유사하다.

조건부 PMF(Conditional PMF)로부터 주변 PMF(Marginal PMF)를 계산하는 방법:
- $Y$가 주어졌을 때 $X$의 조건부 PMF를 사용하여 $X$의 주변 PMF를 계산할 수 있다.
- $p_X(x) = \sum_y p_Y(y) p_{X|Y}(x | y)$.

이는 확률을 계산할 때 사용되는 전체 확률 정리와 유사하다.
- $p(X) = \sum_y p(Y) p(X | Y)$.

[예제 2](#예제-2)


# 조건부 기대값 (Conditional Expectation)
- 조건부 기대값은 사건 $A$가 일어날 확률 $P(A) > 0$이 주어졌을 때 정의된다.
  - $E[X | A] = \sum_x x p_{X|A}(x | A)$.

- 함수 $g(X)$에 대해서는 다음과 같이 주어진다.
  - $E[g(X) | A] = \sum_x g(x) p_{X|A}(x | A)$.

- 확률 변수 $Y$가 특정 값 $y$를 가질 때 $X$의 조건부 기대값은 다음과 같이 정의된다.
  - $E[X | Y = y] = \sum_x x p_{X|Y}(x | y)$.

### 추가 설명

조건부 기대값은 주어진 사건이나 조건 하에서의 확률 변수의 평균을 나타낸다. 이는 확률 변수가 특정 조건에 따라 어떻게 분포하는지 이해하는 데 중요한 역할을 한다.

- 조건부 확률 질량 함수($p_{X|A}(x|A)$)는 사건 $A$가 일어났을 때, 확률 변수 $X$가 특정 값 $x$를 가질 확률을 나타낸다.
  - 예를 들어, 사건 $A$가 일어난 상태에서 $X$의 기대값을 구하려면, 모든 가능한 $X$의 값에 대해 각 값을 그 값이 나올 조건부 확률로 가중치를 주어 합산한다.

- $Y = y$로 주어진 조건에서의 $X$의 조건부 기대값은 $Y$가 특정 값 $y$를 가질 때, $X$의 기대값을 의미한다.
  - 여기서는 $Y$의 값에 따라 $X$가 어떻게 변화하는지를 알 수 있다. 이는 $X$와 $Y$가 어떻게 관련되어 있는지를 보여 주며, $Y$의 값에 따라 $X$의 평균이 어떻게 달라지는지를 계산할 수 있다.

이러한 계산은 경제학, 엔지니어링, 의학 연구 등 다양한 분야에서 의사 결정을 내리는 데 중요한 정보를 제공한다. 조건부 기대값을 이해하고 계산할 수 있다면, 불확실한 상황에서도 더 정확하고 신뢰할 수 있는 결정을 내릴 수 있다.


# 전체 기대값 정리 (Total Expectation Theorem)

- 전체 기대값 정리는 확률 변수 $X$의 기대값을 다음과 같이 정의한다.
  - $E[X] = \sum_y p_Y(y) E[X | Y = y]$.

- 이는 전체 확률 정리와 유사한 개념으로 확률을 계산하는 데 사용된다.
  - $E[X] = \sum_x x p_X(x) $
	- $= \sum_x x \sum_y p_Y(y) p_{X|Y}(x | y) $ (*조건확률변수로부터 주변확률변수 계산*)
	- $= \sum_y p_Y(y) \sum_x x p_{X|Y}(x | y) $
	- $= \sum_y p_Y(y) E[X | Y = y]$.

### 설명

전체 기대값 정리(Total Expectation Theorem)는 조건부 기대값을 사용하여 확률 변수의 전체 기대값을 계산하는 방법을 제공한다. 이 정리는 확률 변수가 다른 변수에 의존할 때, 전체 기대값을 구조적으로 분해하여 각 조건부 기대값의 가중 평균으로 표현할 수 있게 해준다.

- 전체 확률 정리와의 유사성: 전체 확률 정리는 확률 변수의 분포를 여러 조건부 분포로 나누어 각각을 가중치를 두어 합산한다. 전체 기대값 정리도 이와 유사하게 각 조건의 기대값을 가중치를 두어 합산하여 전체 기대값을 구한다.
  
- 계산 예시:
  - 만약 $Y$가 0 또는 1의 값을 가지며 각각의 확률이 0.5라고 가정하고, $E[X | Y = 0] = 1$, $E[X | Y = 1] = 3$라면,
  - 전체 기대값은 $E[X] = 0.5 \times 1 + 0.5 \times 3 = 2$가 된다.

이 정리는 확률적 시스템이나 데이터 사이언스, 경제학 모델에서 중요한 변수들의 행동을 예측할 때 유용하게 사용된다. 복잡한 확률 구조에서 개별 사건의 영향을 명확하게 파악하고자 할 때, 전체 기대값을 간단하게 계산할 수 있는 수단을 제공한다.

[예제 3](#예제-3)
[예제 4](#예제-4)

# 예제
## 예제 1
### 문제
- X를 주사위를 굴려 나온 수라고 하고, A를 주사위의 눈금이 짝수인 사건이라고 하자.
- 앞서 언급한 공식을 적용하면 다음과 같은 결과를 얻는다.
	- $p_{X|A}(x) = P(X = x | \text{주사위 눈금이 짝수})$
	- $= \frac{P(X = x \text{ 그리고 } X \text{가 짝수})}{P(\text{주사위 눈금이 짝수})}$
	- $= \left\{\begin{array}{ll}1/3 & \text{if } x = 2, 4, 6, \\0 & \text{otherwise}.\end{array}\right.$

### 설명
X: 주사위를 굴려 나온 수
A: 주사위의 눈금이 짝수인 사건 (A = {2, 4, 6})

$P_{X|A}(2) = \frac{|\{X = 2\} \cap \{2, 4, 6\}|}{3} = \frac{1}{3}$이다.
$P_{X|A}(4) = \frac{|\{X = 4\} \cap \{2, 4, 6\}|}{3} = \frac{1}{3}$이다.
$P_{X|A}(6) = \frac{|\{X = 6\} \cap \{2, 4, 6\}|}{3} = \frac{1}{3}$이다.
Conditional PMF는 X가 2, 4, 6일 때만 1/3이고, 그 외의 경우에는 0 -> $P_{X|A}(1, 3, 5) = \frac{|\{X = 1, 3, 5\} \cap \{2, 4, 6\}|}{3} = 0$이다.


## 예제 2
### 문제
- 이 예제에서는 6면 주사위를 독립적으로 네 번 던진다.
- $X$는 나온 1의 개수를 나타내고, $Y$는 나온 2의 개수를 나타낸다.
- $X$와 $Y$의 결합 확률 질량 함수(Joint PMF)를 구하는 문제다.
### 풀이
X: 4번의 시도 중 나온 1의 개수, Y: 4번의 시도 중 나온 2의 개수
X, Y : Binomial R.V (n = 4, p = 1/6)
$P(X = x, Y = y) = P(Y = y)P(X = x | Y = y)$
이때, $P(Y = y) = \binom{4}{y} \left(\frac{1}{6}\right)^y \left(\frac{5}{6}\right)^{4-y}$이다.
$P(X = x | Y = y)$에서 
- $Y = y$는
	1. 4번의 시도 중 y번의 2가 나오는 경우
	2. 남은 4-y의 시도
	3. 4-y의 시도 중 2가 나오지 않는 경우 중 x번의 1이 나오는 경우는 1/5이다.
- $X|Y = y$는
	1. 남은 4-y의 시도 중 x번의 1이 나오는 경우
	2. Binomial R.V (n = 4-y, p = 1/5)
	3. $P(X = x | Y = y) = \binom{4-y}{x} \left(\frac{1}{5}\right)^x \left(\frac{4}{5}\right)^{4-y-x}$이다.


주변 확률 질량 함수(Marginal PMF) $p_{Y}$는 이항 분포(Binomial PMF)를 따른다.
- $py(y) = \binom{4}{y} \left(\frac{1}{6}\right)^y \left(\frac{5}{6}\right)^{4-y}$, $y = 0, 1, \dots, 4$.

$Y = y$가 주어졌을 때, 남은 $4-y$번의 주사위 던짐에서 1이 나올 확률을 나타내는 조건부 PMF $p_{X|Y}$는 이항 분포다.
- 이 때, 조건부 확률의 파라미터 $n$과 $p$는 $n = 4$와 $p = \frac{1}{6}$이다.

결합 PMF는 다음과 같이 주어진다.
$p_{X,Y}(x, y) = p_Y(y) \times p_{X|Y}(x|y) = \binom{4}{y} \left(\frac{1}{6}\right)^y \left(\frac{5}{6}\right)^{4-y} \times \binom{4-y}{x} \left(\frac{1}{5}\right)^x \left(\frac{4}{5}\right)^{4-y-x}$
이 식은 모든 비음수 정수 $x$와 $y$에 대해 $0 \leq x + y \leq 4$일 때 유효하다.
### 추가 설명
- **조건부 확률 질량 함수($p_{X|Y}(x|y)$)**: $Y = y$가 주어진 상태에서 남은 $4 - y$번의 시행 중 1이 나오는 횟수의 분포를 나타낸다.
  - $X$의 분포는 $4-y$번의 독립 시행에서 각각 $\frac{1}{5}$의 확률로 1이 나올 때의 분포이므로, 이는 $\binom{4-y}{x} \left(\frac{1}{5}\right)^x \left(\frac{4}{5}\right)^{4-y-x}$로 표현된다.

이 슬라이드에서는 $X$와 $Y$의 결합 확률 질량 함수를 구하는 방법을 보여준다. 이 과정은 $Y$의 확률과 $Y$가 주어진 조건에서 $X$의 확률을 곱함으로써 이루어진다. 여기서 $X$와 $Y$는 각각 독립적인 시행에서 특정 결과(주사위에서 1과 2)가 나오는 횟수를 나타낸다.

**주변 확률($p_Y(y)$)**은 $Y$가 특정 값 $y$를 취할 확률로, 이항 분포를 따른다.
**조건부 확률($p_{X|Y}(x|y)$)**은 $Y=y$가 주어졌을 때 남은 $4-y$번의 시행에서 $X=x$가 되는 확률로, 이 또한 이항 분포를 따른다.
이와 같은 계산은 결합 분포를 통해 두 확률 변수 간의 전체적인 관계를 이해할 수 있게 해주며, 통계적 모델링에 있어 중요한 기초가 된다. 특히, 두 변수가 서로 독립적인 경우 각각의 분포만으로 전체 분포를 재구성할 수 있다는 점에서 의미가 크다. 이러한 분석은 복잡한 확률적 현상을 이해하고 예측하는 데 필수적이다.

## 예제 3

### 문제
- 시스템은 각 단계에서 독립적으로 확률 $p$로 실패할 수 있다.
- 확률 변수 $X$는 첫 번째 실패가 일어나기까지의 단계 수를 나타낸다.
- $A$는 시스템이 첫 번째 단계에서 실패하는 사건이다.

$A^C$는?
$P(A)$는?
$P(A^C)$는?
$E[X|A]$는?
$E[X|A^C]$는?
### 풀이
$P_Xx = (1-p)^{x-1}p$이다.
$P(X=1)=p$, $P(X=2)=(1-p)p$, $P(X=3)=(1-p)^2p$, $\dots$

1. $A^C=\{X=1\}$
2. $P(A)=1-P(A^C)=1-p$
3. $P(A^C)=p$
4. $E[X|A]=1$
5. $E[X|A^C]=E[X]+1$


### 설명

이 예제에서는 각 단계에서 시스템이 실패할 확률을 통해 첫 번째 실패가 발생하기까지의 단계 수를 모델링하는 방법을 설명한다.

- $A^C$는 사건 $A$의 여집합으로, 첫 번째 단계에서 시스템이 성공하는 경우를 나타낸다.
- $P(A)$는 $p$로, 첫 번째 단계에서 시스템이 실패할 확률이다.
- $P(A^C)$는 $1-p$로, 첫 번째 단계에서 시스템이 성공할 확률이다.

- $E[X|A]$는 사건 $A$가 발생했을 때의 기대값으로, 첫 번째 단계에서 실패했기 때문에 $X=1$이 확정적이므로 1이다.
- $E[X|A^C]$는 첫 번째 단계에서 실패하지 않았을 때, 즉 첫 번째 단계를 성공하고 이후 단계에서 첫 실패가 발생하기까지의 기대 단계 수를 나타낸다. 첫 번째 단계를 성공하면 $X$의 값은 기대값에 1을 더한 값이 되므로, 만약 $X$의 전체 기대값이 $E(X)$라면 $E[X|A^C] = E(X) + 1$이 된다.

이 예제는 확률론에서 매우 중요한 지형적 분포를 다루며, 시스템의 신뢰성 분석 등에 응용될 수 있다.


## 예제 4
### 문제
- $E[X|A]P(A) + E[X|A^C]P(A^C)$를 계산한다.

### 설명

이 식은 전체 기대값 정리(Total Expectation Theorem)의 실제 적용 예를 나타낸다. 각 조건부 사건에 대한 기대값과 그 사건의 확률을 곱하여 전체 기대값을 계산하는 과정을 보여준다.

- $E[X|A]P(A)$는 시스템이 첫 번째 단계에서 실패할 경우의 기대값과 그 확률의 곱이다.
- $E[X|A^C]P(A^C)$는 첫 번째 단계에서 실패하지 않을 경우의 기대값과 그 확률의 곱이다.

이 예제에서, 첫 번째 단계에서 시스템이 실패할 확률은 $p$, 실패하지 않을 확률은 $1-p$이며, 각 조건부 기대값은 다음과 같다:

- $E[X|A] = 1$ (첫 번째 단계에서 바로 실패하기 때문)
- $E[X|A^C] = E(X) + 1$ (첫 번째 단계를 성공하고 나서 실패하기까지의 기대 단계 수)

따라서, 계산식은 다음과 같다:
\[ E[X|A]P(A) + E[X|A^C]P(A^C) = 1 \cdot p + (E(X) + 1) \cdot (1 - p) \]

이 결과는 전체 기대값 $E(X)$를 나타내며, 확률 모델의 전체적인 행동을 이해하는 데 중요한 역할을 한다.