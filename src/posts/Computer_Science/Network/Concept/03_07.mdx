
# 3.7 TCP 혼잡 제어 (TCP Congestion Control)
## 핵심 질문
- 혼잡 제어를 하고자 한다.
	- 혼잡이 있을 경우, 전송률을 감소시켜 혼잡을 피하거나 완화, 제거한다.
	- 혼잡이 없을 경우, 전송률을 증가시켜 대역폭을 더 잘 활용한다.

- 주요 질문들
	- '전송률'을 어떻게 제어할까?
		- 전송률을 증가시키거나 감소시키는 메커니즘
	- 혼잡을 어떻게 감지할까?
		- 혼잡을 감지하거나 유추하는 메커니즘
	- 전송률을 얼마나, 언제 증가시키거나 감소시킬까?
		- 제어 알고리즘

- 참고: 우리는 TCP의 한 버전인 TCP Reno의 주요 특징만을 살펴볼 것이다.
	- TCP에는 여기서 논의할 것보다 훨씬 많은 내용이 있다.

### 추가 설명

혼잡 제어는 네트워크의 효율적인 운영을 위해 매우 중요한 부분이다. 특히, TCP Reno는 TCP의 대표적인 버전 중 하나로, 네트워크의 혼잡 상태를 관리하는 다음과 같은 방법을 포함한다:

1. **전송률 제어**: TCP Reno는 패킷 손실이 감지될 때 전송률을 감소시키는 메커니즘을 사용한다. 일반적으로 패킷 손실은 네트워크의 혼잡을 나타내므로, 전송률을 줄임으로써 추가 혼잡을 방지하려고 한다.

2. **혼잡 감지**: TCP Reno는 주로 패킷 손실을 통해 혼잡을 감지한다. 손실된 패킷은 타임아웃이 발생하거나, 잘못된 순서로 패킷이 도착하는 것을 통해 감지된다.

3. **전송률 조정**: 전송률은 혼잡 윈도우를 통해 조절된다. 혼잡 윈도우는 네트워크의 상태에 따라 동적으로 조절되며, 이를 통해 네트워크의 처리량과 성능을 최적화한다.

TCP Reno와 같은 프로토콜은 네트워크에서 데이터를 효과적으로 전송하기 위해 설계된 다양한 알고리즘과 전략을 포함하고 있다. 이러한 메커니즘을 이해하고 적절히 적용하는 것은 네트워크 성능을 최대화하고, 사용자 경험을 향상시키는 데 필수적이다.

## TCP 혼잡 제어의 핵심 용어
- 주요 상태 및 메커니즘
	- "slow start" - 전송률의 지수적 증가
	- "congestion avoidance" - "AIMD(Additive Increase/Multiplicative Decrease)"
	- "fast recovery" - 빠른 회복

- 주요 파라미터
	- 혼잡 윈도우: cwnd
	- 슬로우 스타트 임계값: ssthresh
	- MSS, RTT

- 주요 이벤트
	- "ACK received" - 모든 것이 잘 진행되고 있음을 의미
	- "timeout" - 매우 나쁜 상황을 의미
	- "3 duplicate ACK received" - 나쁜 상황이지만 타임아웃만큼은 아님

### 추가 설명

TCP의 혼잡 제어 메커니즘은 네트워크의 효율성을 최대화하고 패킷 손실을 최소화하기 위해 설계되었다. 여기에는 여러 중요한 개념과 파라미터가 있다:

1. **Slow Start**: 연결 초기에 데이터 전송률을 천천히 증가시켜 혼잡 가능성을 최소화한다. 시작 시 혼잡 윈도우(cwnd)는 일반적으로 하나의 세그먼트 크기(MSS)로 설정되며, ACK가 수신될 때마다 이 윈도우는 두 배씩 증가한다.

2. **Congestion Avoidance**: 네트워크가 혼잡해지기 시작하면, 전송률을 점진적으로 증가시키는 AIMD 접근 방식을 사용한다. 데이터 패킷이 성공적으로 전송되면 cwnd는 점진적으로 증가하고, 패킷 손실이 감지되면 크게 감소한다.

3. **Fast Recovery**: 세 개의 중복 ACK이 수신되면, 이는 네트워크에서 패킷 손실이 발생했으나 경로는 여전히 활성화되어 있음을 나타낸다. 이 경우, TCP는 타임아웃을 기다리지 않고 즉시 재전송을 시작한다.

이러한 메커니즘은 네트워크 상황을 신속하게 파악하고 적절히 대응하여 데이터 흐름을 유지하며, 전체적인 네트워크 성능을 개선하는 데 도움을 준다. 각 상태와 이벤트는 TCP 연결의 건전성과 효율성을 유지하는 데 중요한 역할을 한다.

## TCP 혼잡 윈도우
  - 발신자는 전송을 제한한다:
    - 마지막으로 보낸 바이트 - 마지막으로 확인된 바이트 < = cwnd
  - cwnd는 동적이며, 네트워크 혼잡을 감지하는 함수다.
  - TCP 전송률:
    - 대략적으로: cwnd 바이트를 보내고, RTT 동안 ACK를 기다린 후 더 많은 바이트를 보낸다.
    - 전송률 ≈ cwnd / RTT 바이트/초

### 추가 설명

TCP에서 혼잡 윈도우(cwnd)는 네트워크의 혼잡 상태를 기반으로 조절되는 중요한 파라미터이다. 이 윈도우는 발신자가 네트워크를 통해 "in-flight" 상태, 즉 아직 확인되지 않은 상태로 전송할 수 있는 데이터의 최대 양을 결정한다.

1. **혼잡 윈도우의 역할**:
   - 혼잡 윈도우는 네트워크의 전송 능력과 직접적으로 관련이 있어, 네트워크의 성능을 최적화하고 패킷 손실을 방지하는 데 사용된다.
   - cwnd의 크기에 따라 TCP는 데이터를 얼마나 빨리 보낼 수 있는지 결정된다. 네트워크 상황이 좋을 때 cwnd는 증가하여 더 많은 데이터를 보낼 수 있으며, 네트워크 혼잡이 감지될 때는 감소한다.

2. **전송률 계산**:
	- TCP의 전송률은 혼잡 윈도우 크기와 왕복 시간(RTT)에 따라 결정된다. 이 비율은 네트워크의 처리량을 결정하며, 이론적으로는 `cwnd / RTT`와 같다.
	- 이 계산은 혼잡 윈도우가 네트워크의 현재 상태를 어떻게 반영하고 있는지를 나타내며, RTT 동안 전송되고 확인될 수 있는 데이터의 양을 제한한다.

혼잡 윈도우의 관리는 TCP의 성능을 최적화하는 데 중요하며, 이는 네트워크 혼잡을 효과적으로 관리하고 데이터 전송률을 적절하게 조절함으로써 보다 효율적인 네트워크 운영을 가능하게 한다.

## TCP 슬로우 스타트
- 연결이 시작될 때, 첫 번째 손실 이벤트까지 전송률을 지수적으로 증가시킨다:
	- 초기 혼잡 윈도우(cwnd) = 1 MSS
	- 각 RTT마다 혼잡 윈도우를 두 배로 증가
		- 각 수신된 ACK마다 cwnd를 증가시킴
- 초기 전송률은 느리지만, 매우 빠르게 증가
- 모든 ‘타임아웃’ 이벤트 이후에 슬로우 스타트로 돌아감
- 모든 ‘3중 중복 ACK’ 이벤트 이후에 혼잡 회피로 이동

### 추가 설명

TCP 슬로우 스타트는 연결 초기에 네트워크의 혼잡 상태를 천천히 탐색하면서 전송률을 조절하는 방법입니다. 이 접근 방식의 목적은 네트워크 용량을 초과하지 않으면서 점진적으로 전송량을 늘리는 것입니다.

1. **지수적 증가**: 연결 시작 시, cwnd는 하나의 최대 세그먼트 크기(MSS)로 설정되고, 각 RTT마다 혼잡 윈도우 크기는 이전 크기의 두 배로 증가합니다. 이는 네트워크의 처리량을 빠르게 증가시키는 효과가 있지만, 네트워크의 한계를 빠르게 도달할 수도 있습니다.

2. **혼잡 감지 후 조치**: 첫 번째 패킷 손실(타임아웃)이 감지되면, TCP는 혼잡 윈도우를 초기화하고 다시 슬로우 스타트 단계로 돌아갑니다. 이는 네트워크의 혼잡 상태를 재평가하고 더 안정적인 전송률을 찾기 위함입니다.

3. **혼잡 회피 단계**: 세 번의 중복된 ACK 수신은 네트워크 내 일부 경로에서 패킷 손실이 발생했으나 네트워크 연결이 여전히 유효함을 의미합니다. 이 경우 TCP는 혼잡 회피 단계로 전환하여 혼잡 윈도우의 크기를 보수적으로 조정합니다.

이러한 메커니즘을 통해 TCP는 네트워크의 혼잡 상태를 효과적으로 관리하고, 데이터 전송의 신뢰성과 효율성을 높이는데 기여합니다.

