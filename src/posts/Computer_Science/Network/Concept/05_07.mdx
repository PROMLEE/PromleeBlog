# 5.1 개요 (Introduction)
## 네트워크 계층 기능 (Network Layer Functions)
- *Recall*: 두 네트워크 계층 기능
	- **포워딩 (Forwarding)**: 라우터가 패킷을 목적지로 전달하는 과정 - data plane
	- **라우팅 (Routing)**: 목적지까지 패킷을 전달하는 경로를 결정하는 과정 - control plane
- 네트워크 제어 평면을 구조화하는 두 가지 방법
	- 라우터별 제어 (Per-router Control) - 전통적, 여전히 인기있음
	- 논리적으로 중앙 집중화된 제어 (Logically Centralized Control) - 소프트웨어 정의 네트워킹(SDN)에서 사용됨

## 라우터별 제어 (Per-router Control)
> *각 라우터*가 개별적으로 제어 평면을 수행하는 방법

## 논리적으로 중앙 집중화된 제어 (Logically Centralized Control)

# 5.2 라우팅 프로토콜 (Routing Protocols)
## 라우팅 프로토콜 (Routing Protocols)
- 라우팅 프로토콜 목표
	- 라우터 네트워크를 통해 송신 호스트에서 수신 호스트로 가는 *좋은 경로*(또는 라우트)를 결정한다
		- 경로: 주어진 초기 송신 호스트에서 주어진 최종 목적지 호스트로 가기 위해 패킷이 통과할 라우터들의 순서
		- 좋은 경로: 최소 비용, 가장 빠른(최소 지연, 최고 처리량), 최소 혼잡 등
## 네트워크 그래프 추상화 (Network Graph Abstraction)
![240528-171257w](/posts/240528-171257.png)
graph: G = (N, E)
N = set of routers = ${u, v, w, x, y, z}$
E = set of linkes = ${(u, v), (u, x), (v, x), (v, w), (x, w), (x, y), (w, y), (w, z), (y, z)}$

c(x, x') = link x-x'의 비용
ex) c(w, z) = 5

- 비용은 항상 1이 될 수도 있고, 대역폭과 반비례하거나 지연, 혼잡과 관련이 있을 수 있다.
- 경로 $(x_1, x_2, ..., x_n)$의 비용은 $c(x_1, x_2) + c(x_2, x_3) + ... + c(x_{n-1}, x_n)$

질문: $u$와 $z$ 사이의 최소 비용 경로는 무엇인가?
- 라우팅 알고리즘: 그 최소 비용 경로를 찾는 알고리즘

## 라우팅 알고리즘 분류 (Routing Algorithm Classification)
- 라우팅 알고리즘은 두 가지 기본 분류로 나뉜다
	- **Global** 또는 **Decentralized**
	- **Static** 또는 **Dynamic**

### Global vs. Decentralized
- **Global**: 네트워크 전체 정보를 모든 라우터가 가지고 있는 경우
	- 네트워크 링크 상태 정보를 모든 라우터가 가지고 있는 경우
	- **Global** 라우팅 알고리즘은 네트워크 전체 정보를 사용하여 최적 경로를 결정
- **Decentralized**: 각 라우터가 자신의 이웃 라우터에 대한 정보만 가지고 있는 경우
	- **Decentralized** 라우팅 알고리즘은 자신의 이웃 라우터에 대한 정보만 사용하여 최적 경로를 결정

### Static vs. Dynamic
- **Static**: 네트워크 링크 상태가 변하지 않는 경우
	- **Static** 라우팅 알고리즘은 네트워크 링크 상태가 변하지 않는 경우에 사용
- **Dynamic**: 네트워크 링크 상태가 변하는 경우
	- **Dynamic** 라우팅 알고리즘은 네트워크 링크 상태가 변하는 경우에 사용

# 5.2.1 라우팅 프로토콜 - 링크 상태 (Link State Routing Protocol)
## 링크 상태 라우팅 알고리즘 (Link State Routing Algorithm)
### 다익스트라 알고리즘 (Dijkstra's Algorithm)
네트워크 토폴로지와 링크 비용이 모든 노드에 알려져 있다
- *링크 상태 브로드캐스트*를 통해 달성된다
- 모든 노드가 동일한 정보를 가진다
하나의 노드 (라우터)에서 다른 모든 노드까지의 최단 경로를 찾는다
- 해당 노드의 포워딩 테이블을 구성한다
반복적: $k$번의 반복 후 $k$개의 노드에 대한 최단 경로를 찾는다

표기법
- $N'$: 최단 경로가 이미 발견된 노드의 집합
- $D(v)$: 노드 $v$까지의 최단 경로의 길이
- $p(v)$: 노드 $v$까지의 최단 경로에서 $v$의 직전 노드
- $c(x, x')$: 링크 $x-x'$의 비용


# 5.2.2 라우팅 프로토콜 - 거리 벡터 (Distance Vector Routing Protocol)
## 거리 벡터 라우팅 알고리즘 (Distance Vector Routing Algorithm)
### 벨만-포드 알고리즘 (Bellman-Ford Algorithm)
$d_x(y)$: 노드 $x$에서 노드 $y$까지의 최단 경로의 길이
- $d_x(y) = \min_v\{c(x, v) + d_v(y)\}$
- $d_x(y)$: 노드 $x$에서 노드 $y$까지의 최단 경로의 길이

# 5.3 intra-AS routing in the Internet:OSPF (인터넷 내부의 AS 내부 라우팅)
## 라우팅을 확장 가능하게 만들기
- 지금까지의 라우팅 연구는 이상화되었음
	- 모든 라우터가 동일하다
	- 네트워크가 *평평하다*
	- ...실제로는 그렇지 않다

- 규모: 수십억 개의 목적지가 있는 경우
	- 모든 목적지를 라우팅 테이블에 저장할 수 없다
	- 라우팅 테이블 교환이 링크를 압도할 것이다

- 관리적 자율성
	- 인터넷 = 네트워크의 네트워크
	- 각 네트워크 관리자는 자신의 네트워크 내부의 라우팅을 제어하고 싶어할 수 있다.

## 확장 가능한 라우팅을 위한 인터넷 접근 방식
- 라우터를 *Autonomous System*으로 그룹화
	- AS = Autonomous System(AKA. *도메인*)
- **자율 시스템 내부 라우팅(Intra-AS Routing)**
	- 동일한 AS(네트워크) 내부의 호스트 및 라우터 간의 라우팅
	- AS 내의 모든 라우터는 동일한 인트라 도메인 프로토콜을 실행해야 함
	- 다른 AS에 있는 라우터는 다른 인트라 도메인 라우팅 프로토콜을 실행할 수 있음
	- 게이트웨이 라우터: 자신의 AS의 *가장자리*에 있으며, 다른 AS의 라우터와 연결된 링크를 가진다
- **자율 시스템 간 라우팅(Inter-AS Routing)**
	- AS 간의 라우팅
	- 게이트웨이는 인트라 도메인 라우팅뿐만 아니라 인터 도메인 라우팅을 수행함

## 상호 연결된 AS들 (Interconnected ASes)
- 포워딩 테이블은 인트라-AS 및 인터-AS 라우팅 알고리즘에 의해 구성됨
	- 인트라-AS 라우팅은 AS 내 목적지에  대한 항목을 결정함
	- 인터-AS 및 인트라-AS 라우팅은 외부 목적지에 대한 항목을 결정함

## 인터-AS 작업 (Inter-AS tasks)
- AS1의 라우터가 AS1 외부로 향하는 데이터그램을 수신한다고 가정하자:
    - 라우터는 패킷을 게이트웨이 라우터로 전달해야 하지만, 어떤 라우터로 전달해야 할까?
- AS1은 다음을 수행해야 한다:
    1. AS2를 통해 도달 가능한 목적지와 AS3를 통해 도달 가능한 목적지를 학습함
    2. 이 도달 가능성 정보를 AS1의 모든 라우터에 전파함
- 인터-AS 라우팅의 역할!

## 인트라-AS 라우팅 (Intra-AS Routing)
- 내부 게이트웨이 프로토콜 (IGP)로도 알려져 있음
- 가장 일반적인 인트라-AS 라우팅 프로토콜:
    - **RIP: 라우팅 정보 프로토콜 (Routing Information Protocol)**
        - 벨만-포드 알고리즘의 변형
    - **OSPF: 개방형 최단 경로 우선 (Open Shortest Path First)**
        - IS-IS 프로토콜은 본질적으로 OSPF와 동일
        - 다익스트라 알고리즘의 변형
    - **IGRP: 내부 게이트웨이 라우팅 프로토콜 (Interior Gateway Routing Protocol)**
        - 시스코 독점 프로토콜로 수십 년간 사용됨, 2016년까지

## OSPF (Open Shortest Path First)
- *Open*: 공개적으로 사용 가능
- 링크 상태 알고리즘 사용
	- 링크 상태 패킷 전파
	- 각 노드에서의 토폴로지(topology) 맵
	- 다익스트라 알고리즘을 사용하여 최단 경로 계산
- 라우터는 전체 AS의 다른 모든 라우터에 OSPF 링크 상태 광고를 전파
	- TCP나 UDP가 아닌 IP를 통해 직접 OSPF 메시지에 실려 전송됨
	- 링크 상태: 각 연결된 링크에 대해
- IS-IS 프로토콜은 OSPF와 매우 유사하며, OSPF와 동일한 목표를 가짐

# 5.4 Routing among the ISPs: BGP (ISP 간 라우팅)
## 인터넷 인터-AS 라우팅: BGP (Internet Inter-AS Routing: BGP)
> **BGP**: Border Gateway Protocol

- 사실상의 인터 도메인 라우팅 프로토콜: *인터넷을 하나로 묶는 접착제*
- BGP는 각 AS에 다음과 같은 수단을 제공
	- eBGP: 인접한 AS로부터 서브넷 도달 가능성 정보를 획득함
	- iBGP: 모든 AS내부 라우터에 도달 가능성 정보 전파
	- 도달 가능성 정보와 정책을 기반으로 다른 네트워크로 가는 *좋은 경로*를 결정함
- 서브넷이 인터넷의 나머지 부분에 자신의 존재를 광고할 수 있게 함: **여기에 내가 있다**


## eBGP, iBGP 연결 (eBGP, iBGP connections)
게이트웨이 라우터는 eBGP 및 iBGP 프로토콜을 모두 실행

## BGP 기본 개요 (BGP basics)
- BGP 세션: 두 BGP 라우터(*피어*)가 반영구적인 TCP연결을 통해 BGP 메시지 교환
	- 다른 목적지 네트워크 prefix로의 경로를 광고 (BGP는 *경로 벡터* 프로토콜)

예시사진
- AS3 게이트웨이 라우터 3a가 경로 'AS3,X'를 AS2 게이트웨이 라우터 2c에 광고할 때:
    - AS3는 AS2에게 X로 가는 데이터그램을 전달할 것을 약속함