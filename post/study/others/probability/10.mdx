## 확률 변수에 대한 조건화 (Conditioning a Random Variable on an Event)
> 사건 A에 대해 조건화된 확률 변수 X의 조건부 확률 질량 함수(Conditional PMF)는 $P(A) > 0$일 때 다음과 같이 정의된다.
$p_{X|A}(x) = P(X = x | A) = \frac{P(\{X = x\} \cap A)}{P(A)}$


### 예시 (확률 변수에 대한 조건화)
X를 주사위를 굴려 나온 수라고 하고, A를 주사위의 눈금이 짝수인 사건이라고 하자.
앞서 언급한 공식을 적용하면 다음과 같은 결과를 얻는다.
$p_{X|A}(x) = P(X = x | \text{주사위 눈금이 짝수})$
$= \frac{P(X = x \text{ 그리고 } X \text{가 짝수})}{P(\text{주사위 눈금이 짝수})}$
$= \left\{\begin{array}{ll}1/3 & \text{if } x = 2, 4, 6, \\0 & \text{otherwise}.\end{array}\right.$


## 다른 확률 변수에 대한 조건화 (Conditioning one Random Variable on Another)
> 확률 변수 X와 Y가 동일한 실험과 관련되어 있을 때, Y에 대해 조건화된 X의 조건부 확률 질량 함수를 정의한다.
> Conditional PMF of X given Y:  $p_{X|Y}(x | y) = P(X = x | Y = y)$

이는 사건 A의 형태 $\{Y = y\}$로 정의의 특수화와 같다.
조건부 확률의 정의를 사용하면 다음과 같다.
- $p_{X|Y}(x | y) = \frac{P(X = x, Y = y)}{P(Y = y)} = \frac{p_{X,Y}(x, y)}{p_Y(y)}$

### 예시
Joint Probability Mass Function (P(X,Y)):
| X \\ Y |   1  |   2  |   3  |   4  |
|-------|------|------|------|------|
|  1    | 0.1  | 0.1  |  0   | 0.2  |
|  2    | 0.05 | 0.05 | 0.1  |  0   |
|  3    |  0   | 0.1  | 0.2  | 0.1  |

Marginal Probability P(Y):
|   Y   |  1   |   2  |   3  |  4   |
|-------|------|------|------|------|
| P(Y)  | 0.15 | 0.25 | 0.3  | 0.3  |

Conditional Probability Mass Function (P(X|Y)):
| X \\ Y |   1  |   2  |   3  |   4  |
|-------|------|------|------|------|
|  1    | 0.66 | 0.4  |  0   | 0.66 |
|  2    | 0.33 | 0.2  | 0.33 |  0   |
|  3    |  0   | 0.4  | 0.66 | 0.33 |

첫 번째 표는 $X$와 $Y$의 *합동 확률 분포*를 보여준다.
예를 들어, $P(X=1, Y=1) = 0.1$, $P(X=2, Y=1) = 0.05$이다.
두 번째 표는 $Y$의 값에 대한 *주변 확률 분포*를 보여준다.
예를 들어, $P(Y=1) = 0.15$, $P(Y=2) = 0.25$이다.
세 번째 표는 $Y$가 주어졌을 때 $X$의 *조건부 확률 분포*를 보여준다.
예를 들어, $P(X=1|Y=1) = 0.66$, $P(X=2|Y=1) = 0.33$이다.
<br/>


*Conditional PMF 계산순서*
1. Joint PMF 계산
2. Marginalization
3. Marginal PMF 계산
4. Conditional PMF 계산 = Joint PMF / Marginal PMF

예시) 
1. Joint PMF: $P(X=2, Y=1)
2. Marginal PMF: $P(Y=1)
3. Conditional PMF: $P(X=2|Y=1) = \frac{P(X=2, Y=1)}{P(Y=1)} = \frac{0.05}{0.15} = 0.33$

## 유용한 공식 (Useful Rules)
#### 조건부 PMF(Conditional PMF)로부터 결합 PMF(Joint PMF)를 계산하는 방법
$Y=y$일 때 $X$의 조건부 PMF는 결합 PMF와 관련이 있다.
$p_{X,Y}(x, y) = p_Y(y) p_{X|Y}(x | y)$
이는 확률을 계산할 때 사용되는 곱셈 규칙과 유사하다.

#### 조건부 PMF(Conditional PMF)로부터 주변 PMF(Marginal PMF)를 계산하는 방법
$Y$가 주어졌을 때 $X$의 조건부 PMF를 사용하여 $X$의 주변 PMF를 계산할 수 있다.
$p_X(x) = \sum_y p_Y(y) p_{X|Y}(x | y)$
이는 확률을 계산할 때 사용되는 전체 확률 정리와 유사하다.
$p(X) = \sum_y p(Y) p(X | Y)$

### 예제 (다른 확률 변수에 대한 조건화)
#### 문제
6면 주사위를 독립적으로 네 번 던진다.
$X$는 나온 1의 개수를 나타내고, $Y$는 나온 2의 개수를 나타낸다.
$X$와 $Y$의 결합 확률 질량 함수(Joint PMF)를 구하라.
#### 풀이
X: 4번의 시도 중 나온 1의 개수, Y: 4번의 시도 중 나온 2의 개수
X, Y : Binomial R.V (n = 4, p = 1/6)
$P(X = x, Y = y) = P(Y = y)P(X = x | Y = y)$
이때, $P(Y = y) = \binom{4}{y} \left(\frac{1}{6}\right)^y \left(\frac{5}{6}\right)^{4-y}$이다.
$P(X = x | Y = y)$에서 
- $Y = y$는
	1. 4번의 시도 중 y번의 2가 나오는 경우
	2. 남은 4-y의 시도
	3. 4-y의 시도 중 2가 나오지 않는 경우 중 x번의 1이 나오는 경우 → 1/5의 확률
- $X|Y = y$는
	1. 남은 4-y의 시도 중 x번의 1이 나오는 경우
	2. Binomial R.V (n = 4-y, p = 1/5)
	3. $P(X = x | Y = y) = \binom{4-y}{x} \left(\frac{1}{5}\right)^x \left(\frac{4}{5}\right)^{4-y-x}$이다.

주변 확률 질량 함수(Marginal PMF) $p_{Y}$는 이항 분포(Binomial PMF)를 따른다.
- $p_Y(y) = \binom{4}{y} \left(\frac{1}{6}\right)^y \left(\frac{5}{6}\right)^{4-y}$, $y = 0, 1, \dots, 4$.

$Y = y$가 주어졌을 때, 남은 $4-y$번의 주사위 던짐에서 1이 나올 확률을 나타내는 조건부 PMF $p_{X|Y}$는 이항 분포다.
- 이 때, *조건부 확률*의 파라미터 $n$과 $p$는 $n = 4$와 $p = \frac{1}{6}$이다.

*결합 PMF*는 다음과 같이 주어진다.
$p_{X,Y}(x, y) = p_Y(y) \times p_{X|Y}(x|y) = \binom{4}{y} \left(\frac{1}{6}\right)^y \left(\frac{5}{6}\right)^{4-y} \times \binom{4-y}{x} \left(\frac{1}{5}\right)^x \left(\frac{4}{5}\right)^{4-y-x}$
이 식은 모든 비음수 정수 $x$와 $y$에 대해 $0 \leq x + y \leq 4$일 때 유효하다.

## 조건부 기대값 (Conditional Expectation)
조건부 기대값은 사건 $A$가 일어날 확률 $P(A) > 0$이 주어졌을 때 정의된다.
- $E[X | A] = \sum_x x\cdot p_{X|A}(x | A)$.

함수 $g(X)$에 대해서는 다음과 같이 주어진다.
- $E[g(X) | A] = \sum_x g(x) p_{X|A}(x | A)$.

확률 변수 $Y$가 특정 값 $y$를 가질 때 $X$의 조건부 기대값은 다음과 같이 정의된다.
- $E[X | Y = y] = \sum_x x \cdot p_{X|Y}(x | y)$.

## 전체 기대값 정리 (Total Expectation Theorem)
전체 기대값 정리는 확률 변수 $X$의 기대값을 다음과 같이 정의한다.
- $E[X] = \sum_y p_Y(y) E[X | Y = y]$.

이는 *전체 확률 정리*와 유사한 개념으로 확률을 계산하는 데 사용된다.
- $E[X] = \sum_x x p_X(x) $
- $= \sum_x x \sum_y p_Y(y) p_{X|Y}(x | y) $ (*조건확률변수로부터 주변확률변수 계산*)
- $= \sum_y p_Y(y) \sum_x x p_{X|Y}(x | y) $
- $= \sum_y p_Y(y) E[X | Y = y]$.

### 예제 1 (전체 기대값 정리)
#### 문제
시스템은 각 단계에서 독립적으로 확률 $p$로 실패할 수 있다.
확률 변수 $X$는 첫 번째 실패가 일어나기까지의 단계 수를 나타낸다.
$A$는 시스템이 첫 번째 단계에서 실패하는 사건이다.

1. $A^C$ = ?
1. $P(A)$ = ?
1. $P(A^C)$ = ?
1. $E[X|A]$ = ?
1. $E[X|A^C]$ = ?
#### 풀이
$P_Xx = (1-p)^{x-1}p$이다.
$P(X=1)=p$, $P(X=2)=(1-p)p$, $P(X=3)=(1-p)^2p$, $\dots$

1. $A^C=\{X>1\}$
2. $P(A)=P(X=1)=p$
3. $P(A^C)=1-P(A)=1-p$
4. $E[X|A] = \sum_{x=1}^{\infty} x \cdot P(X=x|X=1) \\
=1\cdot P(X=1|X=1)+2\cdot P(X=2|X=1)+3\cdot P(X=3|X=1)+\dots \\
= \frac{P(X=1 \cap X=1)+2\cdot P(X=2 \cap X=1)+3\cdot P(X=3 \cap X=1)+\dots}{P(X=1)} \\
= \frac{P(X=1)}{P(X=1)} + 0 + 0 + \dots \\
= 1$
5. $E[X|A^C]= \sum_{x=1}^{\infty} x \cdot P(X=x|X>1) \\
=2\cdot P(X=2|X>1)+3\cdot P(X=3|X>1)+\dots \\
= \frac{2\cdot P(X=2 \cap X>1)+3\cdot P(X=3 \cap X>1)+\dots}{P(X>1)} \\
= \frac{2\cdot P(X=2)+3\cdot P(X=3)+\dots}{1-P(X=1)} \\
= \frac{P(X=1)+2\cdot P(X=2)+3\cdot P(X=3)+\dots - P(X=1)}{1-P(X=1)} \\
= \frac{E[X] - P(X=1)}{1-P(X=1)} \\
= \frac{E[X] - p}{1-p}$

### 예제 2 (전체 기대값 정리)
#### 문제
$E[X|A]P(A) + E[X|A^C]P(A^C)$를 계산하시오.

#### 풀이
$E[X|A]P(A) + E[X|A^C]P(A^C) \\
= P(A)E[X|A] + P(A^C)E[X|A^C] \\
= p\cdot 1 + (1-p)\cdot \frac{E[X] - p}{1-p} \\
= p + E[X] - p \\
= E[X] \Rightarrow $ *전체 기대값 정리*

## 요약 (Summary)
**확률 변수에 대한 조건화**(Conditioning on a Random Variable)
- $p_{X|A}(x) = P(X = x | A) = \frac{P(\{X = x\} \cap A)}{P(A)}$

**조건부 PMF**(Conditional PMF)로부터 **결합 PMF**(Joint PMF)를 계산하는 방법
- $p_{X,Y}(x, y) = p_Y(y) p_{X|Y}(x | y)$

**조건부 PMF**(Conditional PMF)로부터 **주변 PMF**(Marginal PMF)를 계산하는 방법
- $p_X(x) = \sum_y p_Y(y) p_{X|Y}(x | y)$

**조건부 기대값**(Conditional Expectation)
- $E[X | A] = \sum_x x\cdot p_{X|A}(x | A)$
- $E[g(X) | A] = \sum_x g(x) p_{X|A}(x | A)$
- $E[X | Y = y] = \sum_x x \cdot p_{X|Y}(x | y)$

**전체 기대값 정리**(Total Expectation Theorem)
- $E[X] = \sum_y p_Y(y) E[X | Y = y]$

$A_1, A_2, \dots, A_n$이 **확률 공간의 분할**이라면
- $E[X] = \sum_{i=1}^{n} P(A_i)E[X|A_i]$

## 추가문제
#### 문제
길을 잃은 관광객이 세 갈래 길이 있는 지점에 도착한다.
첫 번째 길은 그를 1시간 후에 같은 지점으로 되돌아오게 한다.
두 번째 길은 그를 6시간 후에 같은 지점으로 되돌아오게 한다.
마지막 길은 그를 2시간 후에 도시로 데려다 준다.
길에는 표지판이 없다.
관광객이 항상 동일한 확률로 길을 선택한다고 가정할 때, 관광객이 도시에 도착할 때까지의 평균 시간은 얼마인가?

#### 풀이
$T$ = 관광객이 도시에 도착할 때까지의 평균 시간
$D_i$ = 관광객이 $i$번째 길을 선택한 사건
$E[T|D_i]$ = 관광객이 $i$번째 길을 선택했을 때 도시에 도착할 때까지의 평균 시간
$P(D_i)$ = 관광객이 $i$번째 길을 선택할 확률
$E[T] = \sum_{i=1}^{3} P(D_i)E[T|D_i]\\
= \frac{1}{3}E[T|D_1] + \frac{1}{3}E[T|D_2] + \frac{1}{3}E[T|D_3]\\
= \frac{1}{3}(1 + E[T] + 6 + E[T] + 2)\\
= \frac{1}{3}(9 + 2E[T])\\
E[T] = \frac{1}{3}(9 + 2E[T])\\
3E[T] = 9 + 2E[T]\\
E[T] = 9$시간