## TCP 혼잡 제어 핵심 질문 (TCP's Congestion Control Key Questions)
**혼잡 제어를 하고자 한다.**
- 혼잡이 있을 경우, *전송률을 감소*시켜 혼잡을 피하거나 완화, 제거한다.
- 혼잡이 없을 경우, *전송률을 증가*시켜 대역폭을 더 잘 활용한다.

참고: 우리는 TCP의 한 버전인 **TCP Reno**의 주요 특징만을 살펴볼 것이다.
- TCP에는 여기서 논의할 것보다 훨씬 많은 내용이 있다.

## TCP 혼잡 제어의 핵심 용어 (TCP's Congestion Control Keywords)
**주요 상태 및 메커니즘**
- *slow start*: 전송률의 지수적 증가
- *congestion avoidance*(혼잡 회피): **AIMD**(Additive Increase/Multiplicative Decrease)
- *fast recovery* - 빠른 회복
<br/>

**주요 파라미터**
- 혼잡 윈도우: *cwnd*
- 슬로우 스타트 임계값: *ssthresh*
- *MSS*: Maximum Segment Size
- *RTT*: Round-Trip Time
<br/>

**주요 이벤트**
- *ACK received* - 모든 것이 잘 진행되고 있음을 의미
- *timeout* - 매우 나쁜 상황을 의미
- *3 duplicate ACK received* - 나쁜 상황이지만 타임아웃만큼은 아님

## TCP 혼잡 윈도우: cwnd (TCP Congestion Window: cwnd)
>네트워크의 혼잡 상태를 기반으로 조절되는 중요한 파라미터이다. 

이 윈도우는 발신자가 네트워크를 통해 "in-flight" 상태, 즉 아직 확인되지 않은 상태로 전송할 수 있는 데이터의 최대 양을 결정한다.
*cwnd*는 동적이며, 네트워크 혼잡을 감지한다.
> 마지막으로 보낸 바이트 - 마지막으로 확인된 바이트 < = cwnd

*TCP 전송률*:
- 대략적으로 *cwnd* 바이트를 보내고, RTT 동안 ACK를 기다린 후 더 많은 바이트를 보낸다.
	> **전송률** ≈ cwnd / RTT (bytes/sec)

## TCP 슬로우 스타트
연결이 시작될 때, 첫 번째 손실 이벤트까지 전송률을 지수적으로 증가시킨다:
- 초기 혼잡 윈도우(cwnd) = 1 MSS
- 각 RTT마다 혼잡 윈도우를 두 배로 증가
	- 각 수신된 ACK마다 *cwnd*를 증가시킴

초기 전송률은 느리지만, 매우 빠르게 증가
모든 *타임아웃* 이벤트 이후에 **슬로우 스타트**로 돌아감
모든 *3중 중복 ACK* 이벤트 이후에 **혼잡 회피**로 이동

## TCP: 혼잡 감지 및 손실 반응 (TCP: Congestion Detection and reacting to Loss)
> 추론된 패킷 손실을 기반으로 혼잡을 감지 - *타임아웃* 또는 *3개의 중복 ACKs*에 의해 손실을 추론함

**타임아웃**에 의한 손실:
- *slow start*로 돌아가는 것과 유사
	- *cwnd*를 **1 MSS**로 설정
	- 윈도우는 ssthresh 임계값까지 지수적으로 증가(slow start와 동일)
- 이후 선형적으로 증가(congestion avoidance 상태로 전환)

**3중 중복 ACKs**에 의한 손실:
- 중복 ACKs는 네트워크가 일부 세그먼트를 전달할 수 있음을 나타냄
- *cwnd*를 절반으로 줄임
- 이후 선형적으로 증가(congestion avoidance 상태로 전환)

## TCP 혼잡 회피: AIMD (TCP Congestion Avoidance: AIMD)
> 송신자는 전송 속도(윈도우 크기)를 증가시키면서 사용 가능한 대역폭을 탐색하며, 손실이 발생할 때까지 지속함

**가산적 증가**(Additive Increase):
- 손실이 감지될 때 까지 RTT마다 *cwnd*를 1MISS씩 증가시킴

**곱셈적 감소**(Multiplicative Decrease):
- 손실이 감지될 때마다 *cwnd*를 절반으로 줄임

<Img src="/posts/240618-115412.png" width={300}/>
AIMD 톱니형 행동: 대역폭을 탐색하는 과정

## TCP: Slow Start에서 혼잡 회피로 전환 (Transition from Slow Start to Congestion Avoidance)
<Img src="/posts/240618-115749.png" width={400}/>
지수 증가에서 선형 증가로 전환:
- *ssthresh* 임계값(타임아웃 이전 값의 절반)을 넘어서면, *cwnd*를 선형적으로 증가시킴
