## 라우터 아키텍쳐 개요 (Router Architecture Overview)
<Img src="/posts/240618-044104.png" width={500}/>
**라우팅 프로세서**(Routing Processor)
- 라우터의 제어 평면을 담당하는 핵심 요소
- 라우팅 알고리즘을 수행하고 라우팅 테이블을 관리

**고속 스위칭 패브릭**(High-Speed Switching Fabric)
- 라우터의 데이터 평면에서 패킷을 고속으로 전달하는 역할을 하는 핵심 구성 요소
<br/>

포워딩 테이블은 라우팅 프로세서에서 라인 카드로 별도의 버스(예: PCI)를 통해 복사됨
각 라인 카드에 그림자 복사본이 있어, 중앙 라우팅 프로세서를 호출하지 않고도 각 입력 포트에서 로컬로 포워딩 결정을 내릴 수 있음

## 입력 포트 기능 (Input Port Functions)
**물리 계층**
- 비트 수준 수신
- 라인 종단(line termination)

**데이터 링크 계층**
- 예: 이더넷
- 프로토콜 수신

**분산 스위칭**(decentralized switching)
헤더 필드 값을 사용하여 입력 포트 메모리의 포워딩 테이블을 사용해 출력 포트를 조회함 (*매치 플러스 액션*)
- 목적지 기반 포워딩: 목적지 IP 주소만을 기반으로 포워딩함 (전통적인 방식)
- 일반화된 포워딩: 헤더 필드의 모든 집합을 기반으로 포워딩함

*목표*: '라인 속도'에서 입력 포트 처리를 완료하는 것
*큐잉*: 데이터그램이 스위치 패브릭으로 포워딩되는 속도보다 빠르게 도착할 경우

### 입력 포트의 다른 기능들 (Other Input Port Functions)
- 물리 계층 및 링크 계층 처리
- 패킷의 버전 번호, 체크섬, TTL 확인
	TTL과 체크섬은 rewrite되어야 함
- 네트워크 관리에 사용되는 카운터 업데이트

## 스위칭 패브릭 (Switching Fabric)
> 입력 버퍼에서 적절한 출력 버퍼로 패킷을 전송하는 역할

스위칭 속도: 패킷이 입력에서 출력으로 전송되는 속도
- 입력/출력 라인 속도의 배수로 측정됨
- N개의 입력: 라인 속도의 N배 스위칭 속도가 적절

### 스위칭 패브릭의 종류
<Img src="/posts/240618-050326.png" width={500}/>
1. 메모리 내부 스위칭
2. 버스 스위칭
3. 크로스바 스위칭

## 입력 포트 큐잉 (Input Port Queuing)
스위칭 패브릭이 모든 입력 포트의 결합 속도보다 느릴 때 → 입력 큐에서 큐잉이 발생할 수 있다
- 입력 버퍼 오버플로로 인한 큐잉 지연 및 손실

선두 홀딩 (Head-of-the-Line) 블로킹: 큐의 첫 번째 패킷이 다른 패킷들을 차단하는 현상
<Img src="/posts/240618-051156.png" width={500}/>
- 하단 빨간색 패킷이 차단됨
- 하단 녹색 패킷이 차단됨 ➔ 녹색 패킷이 HOL 블로킹을 겪음

## 출력 포트 (Output Ports)
> 스위칭 패브릭에서 전달된 패킷을 출력 링크로 전송하는 역할

**데이터그램 버퍼 및 큐잉**(Datagram Buffering and Queuing)
- 스위칭 패브릭에서 패킷이 도착하면, 출력 포트의 버퍼에 저장되고 큐에 대기
- 출력 포트의 속도보다 빠르게 패킷이 도착할 경우 큐잉이 발생할 수 있음

### 출력 포트 큐잉/버퍼링 (Output Port Queuing/Bufferring)
<Img src="/posts/240618-051949.png" width={500}/>
스위치 패브릭을 통해 입력에서 출력으로 패킷이 전달됨
- 도착 속도가 출력 라인 속도를 초과할 때 버퍼링 필요
- 출력 포트 버퍼 오버플로로 인한 큐잉 지연 및 손실

### 출력 포트 스케줄링 (Output Port Scheduling)
> 여러 입력 포트로부터 도착한 패킷 중 어떤 패킷을 먼저 전송할지 결정

**FIFO 스케줄링**
- 큐에 도착한 순서대로 패킷을 전송
	*폐기 정책*
	- 테일 드롭(Tail Drop): 큐가 가득 찼을 때 새로운 패킷을 폐기
	- 우선 순위 폐기(Priority Drop): 우선 순위 패킷을 먼저 폐기
	- 랜덤 조기 폐기(Random Early Drop): 큐가 가득 차기 전에 랜덤하게 패킷을 폐기

**우선 순위 스케줄링**
- 우선 순위가 높은 패킷을 먼저 전송

**라운드 로빈 스케줄링**
- 여러 큐 사이를 순환하며 패킷을 전송
- 각 큐에서 하나의 패킷을 전송한 후 다음 큐로 이동

**가중치 기반 스케줄링**
- 일반화된 라운드 로빈 스케줄링
- 각 클래스는 가중치를 가지며, 가중치가 높은 클래스가 먼저 패킷을 전송